% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/build_mark_histories.R
\name{build_mark_histories}
\alias{build_mark_histories}
\title{Build MARK Capture Histories from Tag Events}
\usage{
build_mark_histories(
  tag_history,
  locs_def,
  site_col = "site_code",
  tag_col = "tag_code",
  time_col = NULL,
  enforce_order = TRUE,
  keep_unknown = FALSE
)
}
\arguments{
\item{tag_history}{A data.frame or tibble of tag observations. Must contain
columns for tag codes and site codes. A time column is optional for ordering events.}

\item{locs_def}{Either a character vector of occasion labels in downstream order,
or a named list where names are occasion labels and each element is a vector of site codes
included in that occasion.}

\item{site_col}{Character; column name in \code{tag_history} containing site codes.
Default is \code{"site_code"}.}

\item{tag_col}{Character; column name in \code{tag_history} containing PIT tag codes.
Default is \code{"tag_code"}.}

\item{time_col}{Character; optional column name in \code{tag_history} containing
event timestamps (POSIXct or parseable) used to order events within tag.}

\item{enforce_order}{Logical; if TRUE, only the first occurrence of each
strictly increasing occasion per tag is kept. Default is TRUE.}

\item{keep_unknown}{Logical; if FALSE, drop events with sites not in the survival map.
Default is FALSE.}
}
\value{
A list with four elements:
\itemize{
\item \code{ch_data} – tibble with one row per tag and a \code{ch} column for
encounter history, plus 0/1 columns per occasion.
\item \code{ch_freq} – tibble of encounter history strings and their frequencies.
\item \code{mapping} – tibble mapping \code{site_code} to \code{occasion} and numeric
\code{occ_idx}.
\item \code{dropped_summary} – tibble summarizing the number of events dropped because
their site was not in the survival map.
}
}
\description{
Converts tag-level observation events into capture histories compatible with
MARK/Program MARK analyses using a flexible survival map. Can handle multiple
sites per occasion, enforce downstream order, and optionally drop unknown sites.
}
\author{
Ryan Kinzer
}
