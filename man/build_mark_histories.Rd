% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/build_mark_histories.R
\name{build_mark_histories}
\alias{build_mark_histories}
\title{Build MARK Capture Histories from Tag Events}
\usage{
build_mark_histories(
  tag_history,
  locs_def,
  site_col = "site_code",
  tag_col = "tag_code",
  time_col = NULL,
  enforce_order = TRUE,
  keep_unknown = FALSE
)
}
\arguments{
\item{tag_history}{A data frame or tibble with at least the following columns:
\describe{
\item{\code{tag_code}}{Unique identifier for each tagged fish.}
\item{\code{site_code}}{Detection site code.}
\item{\code{event_time}}{Timestamp of the detection event.}
}}

\item{locs_def}{Either a character vector defining the ordered occasions
(e.g., \code{c("SECTRP","ZEN",...)}), or a named list mapping one or more site codes
to occasions
(e.g., \code{list(LGR = c("GRJ","GRS"), Down = c("LMN","MCN","BON"))}).}

\item{site_col}{Character; column name in \code{tag_history} containing site codes.
Default is \code{"site_code"}.}

\item{tag_col}{Character; column name in \code{tag_history} containing PIT tag codes.
Default is \code{"tag_code"}.}

\item{time_col}{Character; optional column name in \code{tag_history} containing
event timestamps (POSIXct or parseable) used to order events within tag.}

\item{enforce_order}{Logical; if TRUE, only the first occurrence of each
strictly increasing occasion per tag is kept. Default is TRUE.}

\item{keep_unknown}{Logical; whether to keep events with site codes not found in
\code{locs_def} (default = \code{FALSE}).}
}
\value{
A list with four elements:
\itemize{
\item \code{ch_data} – tibble with one row per tag and a \code{ch} column for
encounter history, plus 0/1 columns per occasion.
\item \code{ch_freq} – tibble of encounter history strings and their frequencies.
\item \code{mapping} – tibble mapping \code{site_code} to \code{occasion} and numeric
\code{occ_idx}.
\item \code{dropped_summary} – tibble summarizing the number of events dropped because
their site was not in the "study design".
}
}
\description{
Converts tag-level observation events into capture histories compatible with
program MARK. Can handle multiple sites per occasion, enforce downstream order,
and optionally drop unknown sites.
}
\author{
Ryan Kinzer
}
