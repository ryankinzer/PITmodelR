% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fit_marked_cjs.R
\name{fit_marked_cjs}
\alias{fit_marked_cjs}
\title{Fit a CJS Model Using \code{marked}}
\usage{
fit_marked_cjs(
  ch_data,
  phi_formula = ~time,
  p_formula = ~time,
  conf_level = 0.95
)
}
\arguments{
\item{ch_data}{Data frame or tibble with at least the following columns:
\describe{
\item{\code{tag_code}}{Unique identifier for each tagged individual.}
\item{\code{ch}}{Encounter history string (e.g., "11001").}
}}

\item{phi_formula}{Formula specifying the model for survival (\code{Phi}); default \code{~ time}.}

\item{p_formula}{Formula specifying the model for detection probability (\code{p}); default \code{~ time}.}

\item{conf_level}{Numeric; confidence level for Wald intervals (default 0.95).}
}
\value{
A list with components:
\describe{
\item{\code{model}}{The fitted \code{marked} CJS model object.}
\item{\code{phi}}{Data frame of interval survival estimates with columns \code{estimate}, \code{se}, \code{lcl}, \code{ucl}, and interval index.}
\item{\code{cum_phi}}{Data frame of cumulative survival estimates across intervals with confidence intervals.}
\item{\code{p}}{Data frame of interval detection probabilities with columns \code{estimate}, \code{se}, \code{lcl}, \code{ucl}, and interval index.}
\item{\code{plots}}{List of plots for \code{phi}, \code{p}, and \code{cum_phi}. Uses \code{ggplot2} if available, otherwise base R.}
\item{\code{covariance_mode}}{Character indicating whether cumulative survival used "full" covariance or the "independence_fallback".}
}
}
\description{
Fits a CJS capture-recapture model using the \code{marked} package and returns
tidy results for survival (\code{Phi}) and detection (\code{p}) parameters.
Cumulative survival estimates are computed with covariance-aware confidence intervals
when possible; otherwise, an independence-based fallback is used.
}
\details{
This function wraps the \code{marked::crm} workflow for CJS models, extracts tidy parameter
tables, and computes cumulative survival across intervals. If the covariance matrix
for \code{Phi} parameters is available, cumulative survival confidence intervals
account for correlations; otherwise, a simple product-of-bounds approach is used.
}
\author{
Ryan Kinzer
}
